# Logical Design Proposal — v001 Foundation

## Theme Groupings

### Theme 01: `01-project-scaffolding`

**Goal:** Establish the complete Python project structure using uv as the package manager, with a src-layout package containing a minimal hello module. This theme delivers the foundational files that all quality gates and CI depend on — without it, there is nothing to lint, type-check, or test.

**Backlog items:** BL-001, BL-006

**Features:**

| Feature | Goal | Backlog | Dependencies |
|---------|------|---------|--------------|
| `001-pyproject-init` | Initialize pyproject.toml with uv build backend, project metadata, and dev dependencies | BL-001 | None |
| `002-package-structure` | Create `src/test_target_2/` package with `__init__.py` containing version info | BL-001 | 001-pyproject-init |
| `003-hello-module` | Create `hello.py` with a typed `hello()` function returning a greeting string | BL-006 | 002-package-structure |

**Note on BL-001/BL-006 overlap:** BL-001 specifies "hello.py module with a hello() function" and BL-006 specifies "hello() utility function in hello.py." These describe the same deliverable. The design separates them into `002-package-structure` (BL-001 structural aspects) and `003-hello-module` (BL-006 function implementation) so that each feature has a clear, testable boundary. Both BL-001 and BL-006 are marked complete once `003-hello-module` passes.

---

### Theme 02: `02-quality-and-ci`

**Goal:** Configure all quality gate tooling (ruff, mypy, pytest) and a GitHub Actions CI workflow so that every push and PR is automatically validated. This theme transforms the raw scaffolding from Theme 01 into a fully gated project with automated enforcement.

**Backlog items:** BL-002, BL-003, BL-004, BL-005

**Features:**

| Feature | Goal | Backlog | Dependencies |
|---------|------|---------|--------------|
| `001-ruff-config` | Configure ruff linting (E, F, I, UP, B, SIM rules) and formatting (line-length 88) in pyproject.toml | BL-003 | Theme 01 complete |
| `002-mypy-config` | Configure mypy with `strict = true` and Python 3.11 target in pyproject.toml | BL-004 | Theme 01 complete |
| `003-pytest-setup` | Set up pytest with importlib import mode, create `tests/` directory, and write a passing test for `hello()` | BL-002 | Theme 01 complete |
| `004-github-actions` | Create `.github/workflows/ci.yml` running ruff, mypy, and pytest via `uv run` | BL-005 | 001-ruff-config, 002-mypy-config, 003-pytest-setup |

---

## Execution Order

### Inter-Theme Dependencies

Theme 01 **must complete before** Theme 02 begins. Rationale:
- ruff and mypy need source files in `src/test_target_2/` to lint and type-check
- pytest needs the `hello()` function to test
- CI needs all tools configured with passing source code

### Intra-Theme Feature Order

**Theme 01** (strictly sequential):
1. `001-pyproject-init` — creates the project manifest; no source files exist yet
2. `002-package-structure` — creates the package directory; depends on pyproject.toml existing
3. `003-hello-module` — creates the function; depends on the package existing

**Theme 02** (partially parallel, then sequential):
1. `001-ruff-config`, `002-mypy-config`, `003-pytest-setup` — can execute in any order (all depend only on Theme 01, not on each other)
2. `004-github-actions` — must execute last (needs all three tools configured so CI can run them)

### Execution Diagram

```
Theme 01:
  001-pyproject-init → 002-package-structure → 003-hello-module
                                                      ↓
Theme 02:                                     ┌──────────────────┐
                                              │ 001-ruff-config  │
                                              │ 002-mypy-config  │──→ 004-github-actions
                                              │ 003-pytest-setup │
                                              └──────────────────┘
```

---

## Feature Details

### Theme 01, Feature 001: `001-pyproject-init`

**Goal:** Initialize `pyproject.toml` with uv build backend and project metadata.

**Deliverables:**
- `pyproject.toml` with `[project]` section (name, version, description, requires-python >= 3.11)
- `[build-system]` with `uv_build` backend
- `[dependency-groups]` dev group with pytest, ruff, mypy
- `uv.lock` auto-generated by `uv sync`

**Acceptance criteria (from BL-001):**
1. pyproject.toml exists with project metadata and uv configuration
4. Package is installable via `uv sync`

**Research source:** Evidence log — uv pyproject.toml format, `uv_build` backend, `[dependency-groups]` syntax (DeepWiki: astral-sh/uv)

---

### Theme 01, Feature 002: `002-package-structure`

**Goal:** Create the `src/test_target_2/` package with `__init__.py`.

**Deliverables:**
- `src/test_target_2/__init__.py` with `__version__` string

**Acceptance criteria (from BL-001):**
2. `src/test_target_2/__init__.py` exists with version info

---

### Theme 01, Feature 003: `003-hello-module`

**Goal:** Create `hello.py` with a typed `hello()` function returning a greeting string.

**Deliverables:**
- `src/test_target_2/hello.py` with `def hello(name: str = "World") -> str` (or similar)
- Function importable from package: `from test_target_2.hello import hello`
- Full type annotations for mypy strict compliance

**Acceptance criteria (from BL-001 + BL-006):**
3. `src/test_target_2/hello.py` exists with a `hello()` function
1. (BL-006) `hello()` function exists with proper type annotations
2. (BL-006) Function is importable from `test_target_2` package
3. (BL-006) All quality gates pass against this function

**Research source:** Evidence log — hello() typing for mypy strict (DeepWiki: python/mypy)

---

### Theme 02, Feature 001: `001-ruff-config`

**Goal:** Configure ruff linting and formatting in pyproject.toml.

**Deliverables:**
- `[tool.ruff]` section with `line-length = 88`, `target-version = "py311"`
- `[tool.ruff.lint]` with `select = ["E", "F", "I", "UP", "B", "SIM"]`, `ignore = ["E501"]`
- `[tool.ruff.format]` with `quote-style = "double"`, `indent-style = "space"`, `line-ending = "auto"`

**Acceptance criteria (from BL-003):**
1. ruff is listed as a dev dependency
2. ruff configuration exists with line-length, target-version, and rule selections
3. `uv run ruff check src/` passes cleanly
4. `uv run ruff format --check src/` passes cleanly

**Research source:** External research — ruff configuration format (DeepWiki: astral-sh/ruff)

---

### Theme 02, Feature 002: `002-mypy-config`

**Goal:** Configure mypy with strict mode in pyproject.toml.

**Deliverables:**
- `[tool.mypy]` section with `python_version = "3.11"`, `strict = true`

**Acceptance criteria (from BL-004):**
1. mypy is listed as a dev dependency
2. `[tool.mypy]` section exists with `strict = true`
3. `uv run mypy src/` passes cleanly
4. All public functions have type annotations

**Research source:** External research — mypy strict mode flags (DeepWiki: python/mypy)

---

### Theme 02, Feature 003: `003-pytest-setup`

**Goal:** Set up pytest with a basic passing test for `hello()`.

**Deliverables:**
- `[tool.pytest.ini_options]` with `testpaths = ["tests"]`, `addopts = "--import-mode=importlib -ra -q"`
- `tests/conftest.py` (empty or minimal)
- `tests/test_hello.py` with at least one passing test

**Acceptance criteria (from BL-002):**
1. pytest is listed as a dev dependency
2. `tests/` directory exists with `conftest.py`
3. `tests/test_hello.py` exists with at least one passing test
4. `uv run pytest` passes with green output

**Research source:** External research — pytest importlib mode with src layout (DeepWiki: pytest-dev/pytest)

---

### Theme 02, Feature 004: `004-github-actions`

**Goal:** Create a GitHub Actions CI workflow running all quality gates.

**Deliverables:**
- `.github/workflows/ci.yml` with:
  - Triggers on push and pull_request to main
  - `astral-sh/setup-uv@v7` with `enable-cache: true`
  - `uv sync --locked --dev`
  - `uv run ruff check src/`, `uv run ruff format --check src/`, `uv run mypy src/`, `uv run pytest`

**Acceptance criteria (from BL-005):**
1. `.github/workflows/ci.yml` exists
2. Workflow triggers on push and pull_request to main
3. Workflow runs ruff check, ruff format --check, mypy, and pytest
4. Workflow uses uv for Python environment setup

**Research source:** External research — GitHub Actions with uv (DeepWiki: astral-sh/uv)

---

## Backlog Coverage Matrix

| Backlog Item | Theme | Feature(s) | Status |
|-------------|-------|------------|--------|
| BL-001 | 01-project-scaffolding | 001-pyproject-init, 002-package-structure | Mapped |
| BL-002 | 02-quality-and-ci | 003-pytest-setup | Mapped |
| BL-003 | 02-quality-and-ci | 001-ruff-config | Mapped |
| BL-004 | 02-quality-and-ci | 002-mypy-config | Mapped |
| BL-005 | 02-quality-and-ci | 004-github-actions | Mapped |
| BL-006 | 01-project-scaffolding | 003-hello-module | Mapped |

All 6 backlog items are mapped. None deferred.

---

## Research Sources Adopted

| Decision | Evidence | Source |
|----------|----------|--------|
| `uv_build` as build backend | Native backend for src layout projects | DeepWiki: astral-sh/uv |
| `[dependency-groups]` for dev deps | Replaces deprecated `tool.uv.dev-dependencies` | DeepWiki: astral-sh/uv |
| ruff rule set E, F, I, UP, B, SIM | Standard selections per BL-003 + DeepWiki confirmation | DeepWiki: astral-sh/ruff |
| Ignore E501 | Formatter handles line wrapping; linter rule conflicts | DeepWiki: astral-sh/ruff |
| mypy `strict = true` | Enables 14 strict flags via single setting | DeepWiki: python/mypy |
| pytest `--import-mode=importlib` | Recommended for src layout (avoids sys.path hacks) | DeepWiki: pytest-dev/pytest |
| `astral-sh/setup-uv@v7` | Official action with caching support | DeepWiki: astral-sh/uv |
| `uv sync --locked --dev` | Ensures lockfile integrity in CI | DeepWiki: astral-sh/uv |
| All tool config in pyproject.toml | Single config file; no separate ruff.toml/mypy.ini | Task 003 recommendation |
